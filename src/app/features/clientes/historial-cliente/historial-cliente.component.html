<head>
  <link 
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" 
    rel="stylesheet" 
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" 
    crossorigin="anonymous"
  >

</head>
<div class="container mt-4">
    <h3 class="mb-4">Consultar Historial de Compras</h3>

    <div *ngIf="error" class="alert alert-danger">{{ error }}</div>

    <div class="card p-3 mb-4">
        <label for="clienteSelect" class="form-label">Seleccione el Cliente</label>
        <select 
            id="clienteSelect" 
            class="form-select" 
            [(ngModel)]="clienteSeleccionadoId" 
            (ngModelChange)="consultarHistorial()"
            [disabled]="cargandoClientes"
            name="clienteId"
        >
            <option [ngValue]="null" disabled>
                {{ cargandoClientes ? 'Cargando clientes...' : '-- Seleccione un cliente --' }}
            </option>
            <option *ngFor="let cliente of clientes" [ngValue]="cliente.id">
                #{{ cliente.id }} - {{ cliente.nombre }} ({{ cliente.correo }})
            </option>
        </select>
    </div>

    <div *ngIf="clienteSeleccionadoId">
        <h4>Billetes Comprados</h4>

        <div *ngIf="cargandoHistorial" class="alert alert-info">Cargando historial...</div>

        <div *ngIf="!cargandoHistorial && historialBilletes.length === 0" class="alert alert-warning">
            Este cliente no ha comprado billetes.
        </div>

        <div *ngIf="!cargandoHistorial && historialBilletes.length > 0">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>ID Billete</th>
                        <th>NÃºmero</th>
                        <th>Precio</th>
                        <th>Estado</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let billete of historialBilletes">
                        <td>{{ billete.id }}</td>
                        <td>{{ billete.numero }}</td>
                        <td>{{ billete.precio | currency:'USD' }}</td>
                        <td>
                            <span class="badge" [ngClass]="{'bg-success': billete.estado === 'VENDIDO', 'bg-secondary': billete.estado === 'DISPONIBLE'}">
                                {{ billete.estado }}
                            </span>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>