<head>
  <link 
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" 
    rel="stylesheet" 
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" 
    crossorigin="anonymous"
  >

</head>
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <h2 class="text-center mb-4">Creación de Billetes</h2>
            
            <div *ngIf="cargando" class="alert alert-info text-center">Cargando sorteos disponibles...</div>
            
            <div *ngIf="errorGeneral && !creando && !cargando" class="alert alert-danger" role="alert">
                Error: {{ errorGeneral }}
            </div>
            <div *ngIf="registroExitoso" class="alert alert-success" role="alert">
                ¡Billete creado exitosamente para el Sorteo #{{ sorteoSeleccionadoId }}!
            </div>

            <div *ngIf="!cargando && sorteos.length > 0">
                <form [formGroup]="billeteForm" (ngSubmit)="onSubmit()">
                    
                    <div class="mb-4">
                        <label for="sorteoSelect" class="form-label">Asociar a Sorteo</label>
                        <select 
                            id="sorteoSelect" 
                            class="form-select" 
                            [ngModel]="sorteoSeleccionadoId"
                            (ngModelChange)="onSorteoSeleccionado($event)"  
                            name="sorteoSeleccionadoId"
                            [ngModelOptions]="{standalone: true}"
                        >
                            <option [ngValue]="null" disabled>-- Elija el sorteo --</option>
                            <option *ngFor="let sorteo of sorteos" [ngValue]="sorteo.id">
                                #{{ sorteo.id }} - {{ sorteo.nombreSorteo }} (Fecha: {{ sorteo.fechaSorteo }})
                            </option>
                        </select>
                        
                        <div *ngIf="!sorteoSeleccionadoId && errorGeneral?.includes('Debe seleccionar un sorteo')" 
                             class="text-danger mt-1">
                            Debe seleccionar un sorteo.
                        </div>
                    </div>

                    <h5 class="mb-3">Detalles del Billete</h5>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="numero" class="form-label">Número del Billete</label>
                            <input 
                                type="number" 
                                class="form-control" 
                                id="numero" 
                                formControlName="numero"
                                [class.is-invalid]="formControls['numero'].invalid && formControls['numero'].touched"
                            >
                            <div *ngIf="formControls['numero'].invalid && formControls['numero'].touched" class="invalid-feedback">
                                El número es obligatorio y debe ser positivo.
                            </div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="precio" class="form-label">Precio</label>
                            <input 
                                type="number" 
                                class="form-control" 
                                id="precio" 
                                formControlName="precio"
                                [class.is-invalid]="formControls['precio'].invalid && formControls['precio'].touched"
                            >
                            <div *ngIf="formControls['precio'].invalid && formControls['precio'].touched" class="invalid-feedback">
                                El precio es obligatorio y debe ser positivo.
                            </div>
                        </div>
                    </div>

                    <button 
                        type="submit" 
                        class="btn btn-success w-100 mt-3" 
                        [disabled]="billeteForm.invalid || !sorteoSeleccionadoId || creando"
                    >
                        <span *ngIf="creando" class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                        {{ creando ? 'Creando Billete...' : 'Crear Billete' }}
                    </button>
                </form>
            </div>

            <div *ngIf="!cargando && sorteos.length === 0" class="alert alert-warning mt-4">
                No hay sorteos disponibles. Cree uno primero en "Sorteos & Creación".
            </div>
        </div>
    </div>
</div>