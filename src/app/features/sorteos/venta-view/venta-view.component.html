<head>
  <link 
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" 
    rel="stylesheet" 
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" 
    crossorigin="anonymous"
  >

</head>
<div class="container mt-5">
  <h2 class="text-center mb-4">Venta de Billetes</h2>
  
  <div *ngIf="cargando" class="alert alert-info text-center">Cargando listas de Sorteos y Clientes...</div>
  <div *ngIf="error" class="alert alert-danger">{{ error }}</div>

  <div *ngIf="!cargando && sorteos.length > 0 && clientes.length > 0" class="row">

    <div class="col-md-12">
      <div class="card p-4 shadow-sm">
        <h5 class="mb-3">Selecci√≥n y Venta</h5>
        
        <div *ngIf="ventaMensaje" 
            class="alert" 
            [ngClass]="{'alert-success': ventaMensaje.includes('[OK]'), 'alert-danger': ventaMensaje.includes('[ERROR]')}"
        >
            {{ ventaMensaje }}
        </div>

        <form>
            <div class="row">
                <div class="col-md-4 mb-3">
                    <label for="sorteoSelect" class="form-label">Sorteo a Vender</label>
                    <select 
                        id="sorteoSelect" 
                        class="form-select" 
                        [ngModel]="sorteoSeleccionado?.id" 
                        (ngModelChange)="onSorteoSeleccionado($event)"
                        name="sorteoId"
                    >
                        <option [ngValue]="null" disabled>-- Elija un sorteo --</option>
                        <option *ngFor="let sorteo of sorteos" [ngValue]="sorteo.id">
                            {{ sorteo.nombreSorteo }} (Fecha: {{ sorteo.fechaSorteo | date:'shortDate' }})
                        </option>
                    </select>
                </div>

                <div class="col-md-4 mb-3">
                    <label for="clienteSelect" class="form-label">Seleccionar Cliente</label>
                    <select 
                        id="clienteSelect" 
                        class="form-select" 
                        [(ngModel)]="clienteSeleccionadoId" 
                        name="clienteId"
                        [disabled]="!sorteoSeleccionado"
                    >
                        <option [ngValue]="null" disabled>-- Elija un cliente --</option>
                        <option *ngFor="let cliente of clientes" [ngValue]="cliente.id">
                            #{{ cliente.id }} - {{ cliente.nombre }}
                        </option>
                    </select>
                </div>
                
                <div class="col-md-4 mb-3">
                    <label for="billeteSelect" class="form-label">Seleccionar Billete (Disponible)</label>
                    <select 
                        id="billeteSelect" 
                        class="form-select" 
                        [(ngModel)]="billeteSeleccionadoId" 
                        name="billeteId"
                        [disabled]="!sorteoSeleccionado || billetesDisponibles.length === 0"
                    >
                        <option [ngValue]="null" disabled>
                            {{ sorteoSeleccionado ? '-- Elija un billete --' : 'Seleccione un sorteo' }}
                        </option>
                        <option *ngFor="let billete of billetesDisponibles" [ngValue]="billete.id">
                            #{{ billete.numero }} - {{ billete.precio | currency:'USD' }}
                        </option>
                    </select>
                    <small *ngIf="sorteoSeleccionado && billetesDisponibles.length === 0" class="text-danger">
                        No quedan billetes disponibles en este sorteo.
                    </small>
                </div>
            </div>
        </form>

        <button 
            class="btn btn-primary w-100 mt-3" 
            (click)="venderBillete()" 
            [disabled]="!sorteoSeleccionado || !clienteSeleccionadoId || !billeteSeleccionadoId || procesandoVenta"
        >
            <span *ngIf="procesandoVenta" class="spinner-border spinner-border-sm me-2"></span>
            {{ procesandoVenta ? 'Procesando Venta...' : 'Vender Billete Seleccionado' }}
        </button>
      </div>
    </div>
  </div>
  
  <div *ngIf="!cargando && sorteos.length === 0" class="alert alert-warning mt-4">
    No hay sorteos creados. Cree uno primero en "Sorteos".
  </div>
  <div *ngIf="!cargando && clientes.length === 0" class="alert alert-warning mt-4">
    No hay clientes registrados. Registre uno primero en "Clientes e Historial".
  </div>
</div>